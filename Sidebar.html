<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <!-- The CSS package above applies Google styling to buttons and other elements. -->
    <style>
    .sidebar {
      bottom: 54px;
      top: 0;
    }
    
    .width-100 {
      width: 100%;
      box-sizing: border-box;
      -webkit-box-sizing : border-box;â€Œ
      -moz-box-sizing : border-box;
    }
    
    label {
      font-weight: bold;
    }
    
    input[type=text] {
      margin-bottom: 10px;
    }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <form>
        <div class="block form-group" id="airtable-destination-settings">
          <label for="api-key">API Key (Editor permissions)</label>
          <input type="text" class="width-100" id="api-key"/>
          <label for="app-id">App Id</label>
          <input type="text" class="width-100" id="app-id"/>
          <label for="table-name">Table Name</label>
          <input type="text" class="width-100" id="table-name"/>
        </div>  
        <button class="action" id="save-settings">Link</button>
      </form>
    </div>    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
    <script>
      /**
       * On document load, assign required handlers to each element,
       * and attempt to load any saved settings.
       */
       $(function() {
         $('#save-settings').click(saveSettingsToServer);
         google.script.run
           .withSuccessHandler(loadSettings)
//           .withFailureHandler(showStatus)
//           .withUserObject($('#button-bar').get())
           .getSettings();
         });

     /**
       * Callback function that populates the notification options using
       * previously saved values.
       *
       * @param {Object} settings The saved settings from the client.
       */
      function loadSettings(settings) {
//        $('#creator-email').val(settings.creatorEmail);
        $('#table-name').val(settings.tableName);      
        $('#app-id').val(settings.appId);      
        $('#api-key').val(settings.apiKey);      
      }
        
      /**
       * Collects the options specified in the add-on sidebar and sends them to
       * be saved as Properties on the server.
       */
      function saveSettingsToServer() {
        this.disabled = true;
        
        var settings = { 
          'tableName': $("#table-name").val().trim(),
          'appId': $("#app-id").val().trim(),
          'apiKey': $("#api-key").val().trim() 
        };
        
        // Save the settings on the server
        google.script.run
            .withSuccessHandler(
              function(msg, element) {
                element.disabled = false;
              })
            .withFailureHandler(
              function(msg, element) {
                element.disabled = false;
              })
            .withUserObject(this)
            .saveSettings(settings);
      }             
     </script>
  </body>
</html>


